<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.fms.service.mapper.CalSalaryServiceMapper">

	<!-- 查询某个交易的折标系数 -->
	<select id="getScaleFactor" parameterType="java.util.Map"
		resultType="java.util.Map">
		
	<!--s-->
	select  IFNULL(FUNC_GET_SCALE_FACTOR(${tradeInfoId}, ${trueMoney}),0) "scaleFactor" from dual
	</select>
	
	<!-- 计算某个财富产品某个月的总的认购费 -->
	<select id="getSubscriptionFeeAMonth" parameterType="java.util.Map" resultType="java.math.BigDecimal">
	
	<!--s-->
	select IFNULL(sum(a.actu_subscription_amount), 0)
	from t_trade_status_info a, t_trade_info b, t_Trade_Product_Info_View c
	where a.trade_info_id = b.trade_info_id
	and b.trade_info_id = c.TRADE_INFO_ID
	and a.trade_status = '10'
	and b.agent_id = #{agentId}
	and date_format(b.trade_input_date,'%Y%m') = #{calDate}
	and a.rc_state = 'E'
	and b.rc_state = 'E'
	and c.PRODUCT_ID = #{productId}
	</select>
	
	<!-- 根据总的认购费查找奖金比例-->
	<select id="getWealthBonusRate" parameterType="java.util.Map" resultType="java.math.BigDecimal">
	
	<!--s-->
	select a.bonus_rate
	from T_BASIC_LAW_WEALTH a
	where a.rc_state = 'E'
	and IFNULL(a.subscription_fee_lower, 0)<![CDATA[<=]]> #{totalsubscriptionFeeByMonth}
	and IFNULL(a.subscription_fee_upper, 100000000000)<![CDATA[>]]>#{totalsubscriptionFeeByMonth}
	and a.product_id = #{productId} 
	</select>
	
   <!-- 根据产品期限-财富产品查找久期系数-->
	<select id="getWealthDurationRate" parameterType="java.util.Map" resultType="java.math.BigDecimal">
	<!--s-->
	select a.duration_rate
	from t_basic_law_assess a, t_basic_law b
	where
	a.basic_law_id=b.basic_law_id
	and a.param = 'duration'
	and a.param_unit = 'Y'
	and a.rc_state = 'E'
	and b.exec_state='1'
	and b.rc_state='E'
	and a.product_id=#{productId}
	and IFNULL(a.param_lower, 0)<![CDATA[<=]]>#{duration}
	and IFNULL(a.param_upper,100000000000)<![CDATA[>]]>#{duration}
	</select>
	
	<!-- 根据产品期限-个人寿险-趸交查找久期系数-->
	<select id="getPersonLifeFirstDurationRate" parameterType="java.util.Map" resultType="java.math.BigDecimal">
	
	<!--s-->
	select a.duration_rate
	from t_basic_law_assess a, t_basic_law b
	where a.basic_law_id = b.basic_law_id
	and b.rc_state = 'E'
	and b.exec_state = '1'
	and a.product_id is null
	and a.rc_state = 'E'
	and a.param = 'payPeriod'
	and a.param_unit = '0'
	</select>
	
    <!-- 根据产品期限-个人寿险-缴费年期查找久期系数-->
	<select id="getPersonLifeDurationRate" parameterType="java.util.Map" resultType="java.math.BigDecimal">
	<!--s-->
	  select a.duration_rate 
      from t_basic_law_assess a, t_basic_law b
      where a.basic_law_id = b.basic_law_id
     and b.rc_state = 'E'
     and b.exec_state = '1'
     and a.rc_state = 'E'
     and a.param = 'payPeriod'
     and a.param_lower=#{payPeriod}
     and a.param_unit=#{payPeriodUnit}
     and a.product_id is null
	</select>
	
	<!-- 根据产品期限-银行保险-趸交查找久期系数-->
	<select id="getYBLifeFirstDurationRate" parameterType="java.util.Map" resultType="java.math.BigDecimal">
	
	<!--s-->
	select a.duration_rate
	from t_basic_law_assess a, t_basic_law b
	where a.basic_law_id = b.basic_law_id
	and b.rc_state = 'E'
	and b.exec_state = '1'
	and a.product_id=#{productId}
	and a.rc_state = 'E'
	and a.param = 'payPeriod'
	and a.param_unit = '0'
	</select>
	
    <!-- 根据产品期限-银行保险-缴费年期查找久期系数-->
	<select id="getYBLifeDurationRate" parameterType="java.util.Map" resultType="java.math.BigDecimal">
	
	<!--s-->
	  select a.duration_rate 
      from t_basic_law_assess a, t_basic_law b
      where a.basic_law_id = b.basic_law_id
     and b.rc_state = 'E'
     and b.exec_state = '1'
     and a.rc_state = 'E'
     and a.param = 'payPeriod'
     and a.param_lower=#{payPeriod}
     and a.param_unit=#{payPeriodUnit}
     and a.product_id =#{productId}
	</select>
	<!-- 根据总的标准保费查找个人寿险奖金比例-->
	<select id="getPersonLifeBonusRate" parameterType="java.util.Map" resultType="java.math.BigDecimal">
	<!--s-->
	select a.bonus_rate
	from T_BASIC_LAW_INS a
	where a.rc_state = 'E'
	and a.policy_year = #{policyYear}  
	and IFNULL(a.premium_lower, 0) <![CDATA[<=]]>#{totalpersonLifeFeeByMonth} and IFNULL(a.premium_upper, 100000000000)
	<![CDATA[>]]>#{totalpersonLifeFeeByMonth} and a.product_id  is null
	</select>
	
		
	<!-- 获取某交易的保险产品的缴费期间和缴费期间单位-->
	<select id="getPayPeriodList" parameterType="java.util.Map" resultType="java.util.Map">
	
	<!--s-->
	select vv.payPeriod "payPeriod", vv.payPeriodUnit "payPeriodUnit"
	from t_trade_product_info_view vv
	where vv.TRADE_INFO_ID = #{tradeInfoId}
	and vv.PRODUCT_ID=#{productId}
	</select>
	
	<!--查询某个财富顾问某个某个人寿险产品的所有承保保单-->
	<select id="getPersonLifeFoundList" parameterType="java.util.Map" resultType="java.util.Map">
	
	<!--s-->
	
	select a.trade_info_id "tradeInfoId",a.actu_premium "actuPremium"
	from
	t_trade_status_info a, t_trade_info b,t_trade_product_info_view c
	where
	a.trade_info_id =
	b.trade_info_id
	and b.trade_staus ='06'
	and
	a.trade_status = '06'
	and c.trade_info_id=a.trade_info_id
	and
	a.rc_state = 'E'
	and c.product_id=#{productId}
	and b.agent_id=#{agentId}
	and
	date_format(a.status_date, '%Y%m') = #{statusDate}
	</select>
	
	<!-- 查找银保奖金比例-->
	<select id="getYBBonusRate" parameterType="java.util.Map" resultType="java.math.BigDecimal">
	
	<!--s-->
	select a.bonus_rate
	from T_BASIC_LAW_YB a, t_Basic_Law b
	where a.basic_law_id = b.basic_law_id
	and b.exec_state = '1'
	and a.product_id = #{productId}
	and a.payment_period = #{payPeriod}
	and a.payment_unit = #{payPeriodUnit}
	and a.policy_year = #{policyYear}
	and a.rc_state = 'E'
	and b.rc_state = 'E'
	</select>
	
	<!-- 获取某个理财经理某款产品某个月的总的标准保费-->
	<select id="getTotalStandrdPremFromData" parameterType="java.util.Map" resultType="java.math.BigDecimal">
	
	<!--s-->
	select sum(a.standard_prem)
	from t_agent_wage a, t_pd_product b
	where a.agent_id = #{agentId}
	and a.product_code = b.product_code
	and a.product_name = b.product_name
	and b.product_id = #{productId}
	and b.rc_state = 'E'
	and a.rc_state = 'E'
	and a.wage_state = '2'
	and a.cal_year = #{calYear}
	and a.cal_month = #{calMonth}
	</select>
	
			
	<!-- 查找某个部门下这个月的所有有业绩的agent-->
	<select id="getAgentIdList" parameterType="java.util.Map" resultType="java.util.Map">	
	
	<!--s-->
	select distinct a.agent_Id "agentId"
  from t_agent_wage a
  where a.department_Id = #{departmentId}
   and a.cal_Year = ${calYear}
   and a.cal_Month = ${calMonth}
   and a.rc_State = 'E'
	</select>
	
	
		<!-- 查询每个agent一个月的总业务费及奖金-->
	<select id="getAgentWageAmonth" parameterType="java.util.Map" resultType="java.lang.Double">
select sum(a.wage_value) "agentWageAmonth"
  from t_agent_Wage a
 where a.rc_state = 'E'
   and a.cal_Year = ${calYear}
   and a.cal_Month = ${calMonth}
   and a.agent_id = ${agentId}
	</select>
</mapper>